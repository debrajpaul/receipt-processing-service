{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.223.0"},"children":{"InfraCdkStack":{"id":"InfraCdkStack","path":"InfraCdkStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.223.0"},"children":{"OpsAlertsTopic":{"id":"OpsAlertsTopic","path":"InfraCdkStack/OpsAlertsTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/OpsAlertsTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Operations Alerts","topicName":"ops-alerts"}}},"pauldebraj7@gmail.com":{"id":"pauldebraj7@gmail.com","path":"InfraCdkStack/OpsAlertsTopic/pauldebraj7@gmail.com","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/OpsAlertsTopic/pauldebraj7@gmail.com/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":"pauldebraj7@gmail.com","protocol":"email","topicArn":{"Ref":"OpsAlertsTopicF77DA89B"}}}}}}}},"OpsAlertsTopicPolicy":{"id":"OpsAlertsTopicPolicy","path":"InfraCdkStack/OpsAlertsTopicPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.TopicPolicy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/OpsAlertsTopicPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopicPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::TopicPolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sns:Publish","Effect":"Allow","Principal":{"Service":"budgets.amazonaws.com"},"Resource":{"Ref":"OpsAlertsTopicF77DA89B"},"Sid":"0"}],"Version":"2012-10-17"},"topics":[{"Ref":"OpsAlertsTopicF77DA89B"}]}}}}},"AutomatedReceiptsBucket":{"id":"AutomatedReceiptsBucket","path":"InfraCdkStack/AutomatedReceiptsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/AutomatedReceiptsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"automated-receipts-333208197562","publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}},"Policy":{"id":"Policy","path":"InfraCdkStack/AutomatedReceiptsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/AutomatedReceiptsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"AutomatedReceiptsBucketF072455A"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"Notifications":{"id":"Notifications","path":"InfraCdkStack/AutomatedReceiptsBucket/Notifications","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/AutomatedReceiptsBucket/Notifications/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.223.0"}}}}}},"ReceiptsDlq":{"id":"ReceiptsDlq","path":"InfraCdkStack/ReceiptsDlq","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/ReceiptsDlq/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"receipts-dlq"}}}}},"ReceiptsQueue":{"id":"ReceiptsQueue","path":"InfraCdkStack/ReceiptsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/ReceiptsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"queueName":"receipts-queue","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["ReceiptsDlq731F2BBC","Arn"]},"maxReceiveCount":3},"sqsManagedSseEnabled":true,"visibilityTimeout":300}}},"Policy":{"id":"Policy","path":"InfraCdkStack/ReceiptsQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/ReceiptsQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]}},"StringEquals":{"aws:SourceAccount":"333208197562"}},"Effect":"Allow","Principal":{"Service":"s3.amazonaws.com"},"Resource":{"Fn::GetAtt":["ReceiptsQueue30E2F02B","Arn"]},"Sid":"AllowOnlyReceiptsBucketToSend"},{"Action":["sqs:SendMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl"],"Condition":{"ArnLike":{"aws:SourceArn":{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]}}},"Effect":"Allow","Principal":{"Service":"s3.amazonaws.com"},"Resource":{"Fn::GetAtt":["ReceiptsQueue30E2F02B","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"ReceiptsQueue30E2F02B"}]}}}}}}},"ReceiptsTable":{"id":"ReceiptsTable","path":"InfraCdkStack/ReceiptsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/ReceiptsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"receipt_id","attributeType":"S"},{"attributeName":"date","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"receipt_id","keyType":"HASH"},{"attributeName":"date","keyType":"RANGE"}],"tableName":"Receipts"}}},"ScalingRole":{"id":"ScalingRole","path":"InfraCdkStack/ReceiptsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}}}},"WorkerVpc":{"id":"WorkerVpc","path":"InfraCdkStack/WorkerVpc","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Vpc","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerVpc/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPC","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPC","aws:cdk:cloudformation:props":{"cidrBlock":"10.0.0.0/16","enableDnsHostnames":true,"enableDnsSupport":true,"instanceTenancy":"default","tags":[{"key":"Name","value":"InfraCdkStack/WorkerVpc"}]}}},"PublicSubnet1":{"id":"PublicSubnet1","path":"InfraCdkStack/WorkerVpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.223.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"InfraCdkStack/WorkerVpc/PublicSubnet1/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"ap-south-1a","cidrBlock":"10.0.0.0/17","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"InfraCdkStack/WorkerVpc/PublicSubnet1"}],"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}},"Acl":{"id":"Acl","path":"InfraCdkStack/WorkerVpc/PublicSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"InfraCdkStack/WorkerVpc/PublicSubnet1/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"InfraCdkStack/WorkerVpc/PublicSubnet1"}],"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"InfraCdkStack/WorkerVpc/PublicSubnet1/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"WorkerVpcPublicSubnet1RouteTable64D1002B"},"subnetId":{"Ref":"WorkerVpcPublicSubnet1Subnet549B8620"}}}},"DefaultRoute":{"id":"DefaultRoute","path":"InfraCdkStack/WorkerVpc/PublicSubnet1/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"WorkerVpcIGWC2B94A1A"},"routeTableId":{"Ref":"WorkerVpcPublicSubnet1RouteTable64D1002B"}}}}}},"PublicSubnet2":{"id":"PublicSubnet2","path":"InfraCdkStack/WorkerVpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.223.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"InfraCdkStack/WorkerVpc/PublicSubnet2/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"ap-south-1b","cidrBlock":"10.0.128.0/17","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"InfraCdkStack/WorkerVpc/PublicSubnet2"}],"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}},"Acl":{"id":"Acl","path":"InfraCdkStack/WorkerVpc/PublicSubnet2/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"InfraCdkStack/WorkerVpc/PublicSubnet2/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"InfraCdkStack/WorkerVpc/PublicSubnet2"}],"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"InfraCdkStack/WorkerVpc/PublicSubnet2/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"WorkerVpcPublicSubnet2RouteTableAB97C578"},"subnetId":{"Ref":"WorkerVpcPublicSubnet2Subnet4C3F610E"}}}},"DefaultRoute":{"id":"DefaultRoute","path":"InfraCdkStack/WorkerVpc/PublicSubnet2/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"WorkerVpcIGWC2B94A1A"},"routeTableId":{"Ref":"WorkerVpcPublicSubnet2RouteTableAB97C578"}}}}}},"IGW":{"id":"IGW","path":"InfraCdkStack/WorkerVpc/IGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInternetGateway","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::InternetGateway","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"InfraCdkStack/WorkerVpc"}]}}},"VPCGW":{"id":"VPCGW","path":"InfraCdkStack/WorkerVpc/VPCGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCGatewayAttachment","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCGatewayAttachment","aws:cdk:cloudformation:props":{"internetGatewayId":{"Ref":"WorkerVpcIGWC2B94A1A"},"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}}}},"WorkerSecurityGroup":{"id":"WorkerSecurityGroup","path":"InfraCdkStack/WorkerSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for the receipt worker service","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"vpcId":{"Ref":"WorkerVpcA12AC6F9"}}}}}},"WorkerCluster":{"id":"WorkerCluster","path":"InfraCdkStack/WorkerCluster","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Cluster","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerCluster/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCluster","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Cluster","aws:cdk:cloudformation:props":{"clusterName":"receipt-worker-cluster"}}}}},"WorkerLogGroup":{"id":"WorkerLogGroup","path":"InfraCdkStack/WorkerLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/ecs/receipt-worker","retentionInDays":30}}}}},"WorkerTaskDefinition":{"id":"WorkerTaskDefinition","path":"InfraCdkStack/WorkerTaskDefinition","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.FargateTaskDefinition","version":"2.223.0","metadata":[]},"children":{"TaskRole":{"id":"TaskRole","path":"InfraCdkStack/WorkerTaskDefinition/TaskRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.223.0","metadata":[]},"children":{"ImportTaskRole":{"id":"ImportTaskRole","path":"InfraCdkStack/WorkerTaskDefinition/TaskRole/ImportTaskRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerTaskDefinition/TaskRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"InfraCdkStack/WorkerTaskDefinition/TaskRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerTaskDefinition/TaskRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:ReceiveMessage","sqs:ChangeMessageVisibility","sqs:GetQueueUrl","sqs:DeleteMessage","sqs:GetQueueAttributes"],"Effect":"Allow","Resource":{"Fn::GetAtt":["ReceiptsQueue30E2F02B","Arn"]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]},"/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ReceiptsTable036B344A","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"WorkerTaskDefinitionTaskRoleDefaultPolicyEAEEDD06","roles":[{"Ref":"WorkerTaskDefinitionTaskRoleA8028804"}]}}}}}}},"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerTaskDefinition/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnTaskDefinition","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::TaskDefinition","aws:cdk:cloudformation:props":{"containerDefinitions":[{"essential":true,"image":"public.ecr.aws/docker/library/node:18-alpine","name":"receipt-worker","portMappings":[{"containerPort":8080,"protocol":"tcp"}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"WorkerLogGroup31FDBE4A"},"awslogs-stream-prefix":"worker","awslogs-region":"ap-south-1"}},"environment":[{"name":"RECEIPTS_QUEUE_URL","value":{"Ref":"ReceiptsQueue30E2F02B"}},{"name":"RECEIPTS_TABLE_NAME","value":{"Ref":"ReceiptsTable036B344A"}},{"name":"RECEIPTS_BUCKET_NAME","value":{"Ref":"AutomatedReceiptsBucketF072455A"}}]}],"cpu":"512","executionRoleArn":{"Fn::GetAtt":["WorkerTaskDefinitionExecutionRole8F38446C","Arn"]},"family":"InfraCdkStackWorkerTaskDefinition794769B3","memory":"1024","networkMode":"awsvpc","requiresCompatibilities":["FARGATE"],"taskRoleArn":{"Fn::GetAtt":["WorkerTaskDefinitionTaskRoleA8028804","Arn"]}}}},"WorkerContainer":{"id":"WorkerContainer","path":"InfraCdkStack/WorkerTaskDefinition/WorkerContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.223.0"}},"ExecutionRole":{"id":"ExecutionRole","path":"InfraCdkStack/WorkerTaskDefinition/ExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.223.0","metadata":[]},"children":{"ImportExecutionRole":{"id":"ImportExecutionRole","path":"InfraCdkStack/WorkerTaskDefinition/ExecutionRole/ImportExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerTaskDefinition/ExecutionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"InfraCdkStack/WorkerTaskDefinition/ExecutionRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerTaskDefinition/ExecutionRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["WorkerLogGroup31FDBE4A","Arn"]}}],"Version":"2012-10-17"},"policyName":"WorkerTaskDefinitionExecutionRoleDefaultPolicy849552D7","roles":[{"Ref":"WorkerTaskDefinitionExecutionRole8F38446C"}]}}}}}}}}},"WorkerService":{"id":"WorkerService","path":"InfraCdkStack/WorkerService","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.FargateService","version":"2.223.0","metadata":[]},"children":{"Service":{"id":"Service","path":"InfraCdkStack/WorkerService/Service","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnService","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Service","aws:cdk:cloudformation:props":{"cluster":{"Ref":"WorkerClusterB2BB5BD9"},"deploymentConfiguration":{"maximumPercent":200,"minimumHealthyPercent":50,"alarms":{"alarmNames":[],"enable":false,"rollback":false}},"desiredCount":1,"enableEcsManagedTags":false,"launchType":"FARGATE","networkConfiguration":{"awsvpcConfiguration":{"assignPublicIp":"ENABLED","subnets":[{"Ref":"WorkerVpcPublicSubnet1Subnet549B8620"},{"Ref":"WorkerVpcPublicSubnet2Subnet4C3F610E"}],"securityGroups":[{"Fn::GetAtt":["WorkerSecurityGroup5529CF0B","GroupId"]}]}},"serviceName":"receipt-worker-service","taskDefinition":{"Ref":"WorkerTaskDefinition8AD2CCFF"}}}},"ScalingRole":{"id":"ScalingRole","path":"InfraCdkStack/WorkerService/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"TaskCount":{"id":"TaskCount","path":"InfraCdkStack/WorkerService/TaskCount","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ScalableTaskCount","version":"2.223.0"},"children":{"Target":{"id":"Target","path":"InfraCdkStack/WorkerService/TaskCount/Target","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.ScalableTarget","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerService/TaskCount/Target/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalableTarget","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalableTarget","aws:cdk:cloudformation:props":{"maxCapacity":10,"minCapacity":1,"resourceId":{"Fn::Join":["",["service/",{"Ref":"WorkerClusterB2BB5BD9"},"/",{"Fn::GetAtt":["WorkerService99815FA9","Name"]}]]},"roleArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::333208197562:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService"]]},"scalableDimension":"ecs:service:DesiredCount","serviceNamespace":"ecs"}}},"SqsBacklogTargetTracking":{"id":"SqsBacklogTargetTracking","path":"InfraCdkStack/WorkerService/TaskCount/Target/SqsBacklogTargetTracking","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.TargetTrackingScalingPolicy","version":"2.223.0"},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerService/TaskCount/Target/SqsBacklogTargetTracking/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalingPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalingPolicy","aws:cdk:cloudformation:props":{"policyName":"InfraCdkStackWorkerServiceTaskCountTargetSqsBacklogTargetTracking6392C761","policyType":"TargetTrackingScaling","scalingTargetId":{"Ref":"WorkerServiceTaskCountTarget94398C8F"},"targetTrackingScalingPolicyConfiguration":{"customizedMetricSpecification":{"dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["ReceiptsQueue30E2F02B","QueueName"]}}],"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","statistic":"Average"},"targetValue":10}}}}}}}}}}}},"BucketNotificationsHandler050a0587b7544547bf325f094a3db834":{"id":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Role":{"id":"Role","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.223.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.223.0","metadata":[]}},"Resource":{"id":"Resource","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:PutBucketNotification","Effect":"Allow","Resource":{"Fn::GetAtt":["AutomatedReceiptsBucketF072455A","Arn"]}}],"Version":"2012-10-17"},"policyName":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36","roles":[{"Ref":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"}]}}}}}}},"Resource":{"id":"Resource","path":"InfraCdkStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.223.0"}}}},"WorkerErrorMetricFilter":{"id":"WorkerErrorMetricFilter","path":"InfraCdkStack/WorkerErrorMetricFilter","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.MetricFilter","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerErrorMetricFilter/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnMetricFilter","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::MetricFilter","aws:cdk:cloudformation:props":{"filterPattern":"?\"ERROR\" ?\"Error\" ?\"Unhandled\"","logGroupName":{"Ref":"WorkerLogGroup31FDBE4A"},"metricTransformations":[{"metricNamespace":"ReceiptProcessing","metricName":"WorkerErrors","metricValue":"1","defaultValue":0}]}}}}},"ReceiptsQueueBacklogAlarm":{"id":"ReceiptsQueueBacklogAlarm","path":"InfraCdkStack/ReceiptsQueueBacklogAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/ReceiptsQueueBacklogAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlertsTopicF77DA89B"}],"alarmDescription":"Receipts queue backlog exceeds 50 messages for 5 minutes","comparisonOperator":"GreaterThanThreshold","datapointsToAlarm":5,"dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["ReceiptsQueue30E2F02B","QueueName"]}}],"evaluationPeriods":5,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":60,"statistic":"Average","threshold":50}}}}},"WorkerErrorAlarm":{"id":"WorkerErrorAlarm","path":"InfraCdkStack/WorkerErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.223.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"InfraCdkStack/WorkerErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlertsTopicF77DA89B"}],"alarmDescription":"Worker logs contain errors for 5 minutes","comparisonOperator":"GreaterThanThreshold","datapointsToAlarm":1,"evaluationPeriods":1,"metricName":"WorkerErrors","namespace":"ReceiptProcessing","period":300,"statistic":"Sum","threshold":0}}}}},"ReceiptsBudget":{"id":"ReceiptsBudget","path":"InfraCdkStack/ReceiptsBudget","constructInfo":{"fqn":"aws-cdk-lib.aws_budgets.CfnBudget","version":"2.223.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Budgets::Budget","aws:cdk:cloudformation:props":{"budget":{"budgetLimit":{"amount":2000,"unit":"INR"},"budgetName":"ReceiptsBudget","budgetType":"COST","timeUnit":"MONTHLY"},"notificationsWithSubscribers":[{"notification":{"comparisonOperator":"GREATER_THAN","notificationType":"ACTUAL","threshold":100,"thresholdType":"PERCENTAGE"},"subscribers":[{"address":{"Ref":"OpsAlertsTopicF77DA89B"},"subscriptionType":"SNS"}]}]}}},"ReceiptsBucketNameOutput":{"id":"ReceiptsBucketNameOutput","path":"InfraCdkStack/ReceiptsBucketNameOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.223.0"}},"ReceiptsQueueUrlOutput":{"id":"ReceiptsQueueUrlOutput","path":"InfraCdkStack/ReceiptsQueueUrlOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.223.0"}},"ReceiptsQueueArnOutput":{"id":"ReceiptsQueueArnOutput","path":"InfraCdkStack/ReceiptsQueueArnOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.223.0"}},"ReceiptsTableNameOutput":{"id":"ReceiptsTableNameOutput","path":"InfraCdkStack/ReceiptsTableNameOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.223.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"InfraCdkStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"InfraCdkStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.223.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"InfraCdkStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.223.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"InfraCdkStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.223.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"}}}}}